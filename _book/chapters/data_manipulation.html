<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Blanc">

<title>Introducción al análisis de datos con R - 5&nbsp; Manipulación de datos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/visualization.html" rel="next">
<link href="../chapters/data_analisis.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Manipulación de datos</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Introducción al análisis de datos con R</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Prefacio</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/import.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Importación de datos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/dataframes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estructura de data frames</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/data_analisis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Análisis de datos con R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/data_manipulation.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Manipulación de datos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Visualización de datos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/cierre.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Próximos pasos</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenido</h2>
   
  <ul>
  <li><a href="#combinación-y-anexión-de-tablas" id="toc-combinación-y-anexión-de-tablas" class="nav-link active" data-scroll-target="#combinación-y-anexión-de-tablas"><span class="toc-section-number">5.1</span>  Combinación y anexión de tablas</a>
  <ul class="collapse">
  <li><a href="#anexión" id="toc-anexión" class="nav-link" data-scroll-target="#anexión">Anexión</a></li>
  <li><a href="#combinación-de-tablas" id="toc-combinación-de-tablas" class="nav-link" data-scroll-target="#combinación-de-tablas">Combinación de tablas</a></li>
  <li><a href="#desafío" id="toc-desafío" class="nav-link" data-scroll-target="#desafío">Desafío</a></li>
  </ul></li>
  <li><a href="#manejo-de-nas" id="toc-manejo-de-nas" class="nav-link" data-scroll-target="#manejo-de-nas"><span class="toc-section-number">5.2</span>  Manejo de NAs</a>
  <ul class="collapse">
  <li><a href="#identificación-de-datos-faltantes" id="toc-identificación-de-datos-faltantes" class="nav-link" data-scroll-target="#identificación-de-datos-faltantes">Identificación de datos faltantes</a></li>
  <li><a href="#manejo-de-datos-daltantes" id="toc-manejo-de-datos-daltantes" class="nav-link" data-scroll-target="#manejo-de-datos-daltantes">Manejo de datos daltantes</a></li>
  </ul></li>
  <li><a href="#manejo-de-duplicados" id="toc-manejo-de-duplicados" class="nav-link" data-scroll-target="#manejo-de-duplicados"><span class="toc-section-number">5.3</span>  Manejo de duplicados</a></li>
  <li><a href="#manejo-de-fechas" id="toc-manejo-de-fechas" class="nav-link" data-scroll-target="#manejo-de-fechas"><span class="toc-section-number">5.4</span>  Manejo de fechas</a>
  <ul class="collapse">
  <li><a href="#tipo-de-dato-fecha" id="toc-tipo-de-dato-fecha" class="nav-link" data-scroll-target="#tipo-de-dato-fecha">Tipo de dato fecha</a></li>
  <li><a href="#generación-de-variables-de-fechas" id="toc-generación-de-variables-de-fechas" class="nav-link" data-scroll-target="#generación-de-variables-de-fechas">Generación de variables de fechas</a></li>
  </ul></li>
  <li><a href="#desafío-1" id="toc-desafío-1" class="nav-link" data-scroll-target="#desafío-1"><span class="toc-section-number">5.5</span>  Desafío</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Manipulación de datos</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel Blanc </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="combinación-y-anexión-de-tablas" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="combinación-y-anexión-de-tablas"><span class="header-section-number">5.1</span> Combinación y anexión de tablas</h2>
<p>En muchas ocasiones debemos trabajar con varias tablas de forma simultánea, y en otras debemos unificarlas para llegar a la tabla final con la que haremos el análisis. Para hacer estas uniones, debemos ya sea combinar las tablas, o anexarlas.</p>
<section id="anexión" class="level3">
<h3 class="anchored" data-anchor-id="anexión">Anexión</h3>
<p>Anexar dos tablas implica “poner una encima de la otra”, es decir, que las filas de una de las tablas se unan a la otra. Para alcanzar esto debemos tener dos dataframes con estructura similar, es decir que <strong>tengan la misma cantidad de variables y que éstas tengan encabezados similares</strong>.</p>
<p>Para ejemplificar estos casos vamos a trabajar con una serie de tablas ficticias, que responden a los datos de un restaurant imaginario. Lo primero que importaremos son las tablas de ventas de la semana uno y la semana dos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>semana_1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/Restaurant - Week 1 Sales.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(semana_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Customer.ID Food.ID
1         537       9
2          97       4
3         658       1
4         202       2
5         155       9
6         213       8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>semana_2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/Restaurant - Week 2 Sales.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(semana_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Customer.ID Food.ID
1         688      10
2         813       7
3         495      10
4         189       5
5         267       3
6         310       5</code></pre>
</div>
</div>
<p>Tal como puede apreciarse, ambos dataframes tienen dos columnas que corresponden una al id de la comida y otra al id del cliente. Dado que estos dataframes comparten la misma estructura, es posible unirlos. Para hacerlo podemos usar la función <em>rbind.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ventas <span class="ot">&lt;-</span> <span class="fu">rbind</span>(semana_1, semana_2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ventas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Customer.ID Food.ID
1         537       9
2          97       4
3         658       1
4         202       2
5         155       9
6         213       8</code></pre>
</div>
</div>
<p>De esta forma, obtenemos un dataframe de 500 filas y la misma cantidad de columnas.</p>
</section>
<section id="combinación-de-tablas" class="level3">
<h3 class="anchored" data-anchor-id="combinación-de-tablas">Combinación de tablas</h3>
<p>Otra clásica necesidad que se presenta a la hora de trabajar con muchas tablas es el tener combinarlas. Las combinaciones suceden mediante reglas de unión: a través de una determinada clave, cuando estas coinciden entre dos tablas, se pegan las columnas. Los tipos de unión son los siguientes:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/joins.webp" class="img-fluid figure-img"></p>
</figure>
</div>
<ul>
<li><p><em>INNER JOIN:</em> solo quedan las filas que tengan la clave en ambos dataset.</p></li>
<li><p><em>FULL JOIN:</em> quedan todas las filas, sin importar si matchean o no</p></li>
<li><p><em>LEFT JOIN:</em> las filas de la tabla de la izquierda quedan todas, se agregan las que coincidan de la derecha.</p></li>
<li><p><em>RIGHT JOIN:</em> las filas de la tabla de la derecha quedan todas, se agregan las que coincidan de la izquierda.</p></li>
</ul>
<p>Tidyverse tiene funciones específicas para realizar estas uniones. Comencemos importando las tablas a combinar. La tabla de comidas tiene información sobre el id de cada comida del menú, junto con el nombre del item y su precio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>comida <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/Restaurant - Foods.csv"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(comida)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Food.ID  Food.Item Price
1       1      Sushi  3.99
2       2    Burrito  9.99
3       3       Taco  2.99
4       4 Quesadilla  4.25
5       5      Pizza  2.49
6       6      Pasta 13.99</code></pre>
</div>
</div>
<p>El objetivo será combinar esta tabla con la de ventas para tener la descripción y el precio de cada item en la tabla principal. La variable que unirá ambas tablas será Food.ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>union <span class="ot">&lt;-</span> ventas <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(comida, <span class="at">by =</span> <span class="st">"Food.ID"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(union)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Customer.ID Food.ID  Food.Item Price
1         537       9      Donut  0.99
2          97       4 Quesadilla  4.25
3         658       1      Sushi  3.99
4         202       2    Burrito  9.99
5         155       9      Donut  0.99
6         213       8      Salad 11.25</code></pre>
</div>
</div>
<p>Para cada Food.ID, la unión trajo el resto de las columnas de la tabla de comida que coincidiera. Para el caso de los clientes tenemos un problema, y es que la columna por la cual se hará la unión no es similar en ambas tablas. Mientras que en <em>ventas</em> la variable se llama Costumer.ID, en <em>clientes</em> se llama ID. Por tanto, tengo que adaptar mi función de combinación, aclarando cómo se llama cada variable en cada tabla.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>clientes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/Restaurant - Customers.csv"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID First.Name Last.Name Gender       Company                    Occupation
1  1     Joseph   Perkins   Male       Dynazzy Community Outreach Specialist
2  2   Jennifer   Alvarez Female          DabZ       Senior Quality Engineer
3  3      Roger     Black   Male       Tagfeed             Account Executive
4  4     Steven     Evans   Male          Fatz              Registered Nurse
5  5       Judy  Morrison Female       Demivee               Legal Assistant
6  6     Amanda    Howell Female Thoughtbridge              Dental Hygienist</code></pre>
</div>
</div>
<p>Una opción es modificar el nombre de la columna en una de las dos tablas. De otra forma, puede hacerse así:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>union <span class="ot">&lt;-</span> union <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(clientes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Customer.ID"</span> <span class="ot">=</span> <span class="st">"ID"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(union)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Customer.ID Food.ID  Food.Item Price First.Name Last.Name Gender   Company
1         537       9      Donut  0.99     Cheryl   Carroll Female  Zoombeat
2          97       4 Quesadilla  4.25     Amanda   Watkins Female       Ozu
3         658       1      Sushi  3.99    Patrick      Webb   Male Browsebug
4         202       2    Burrito  9.99      Louis  Campbell   Male Rhynoodle
5         155       9      Donut  0.99    Carolyn      Diaz Female  Gigazoom
6         213       8      Salad 11.25      Keith    Foster   Male Gigashots
                     Occupation
1              Registered Nurse
2           Account Coordinator
3 Community Outreach Specialist
4    Account Representative III
5    Database Administrator III
6            VP Quality Control</code></pre>
</div>
</div>
<p>De esta forma, obtenemos la tabla final, en donde pueden realizar análisis.</p>
</section>
<section id="desafío" class="level3">
<h3 class="anchored" data-anchor-id="desafío">Desafío</h3>
<ol type="1">
<li><p>Obtenga las cinco comidas que más se consumen.</p></li>
<li><p>Indique qué cliente ha gastado más en el restaurant.</p></li>
<li><p>¿Cuánto ha sido el gasto promedio por sexo?</p></li>
</ol>
<div class="cell">
<details>
<summary>Posible solución</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cinco_comidas <span class="ot">&lt;-</span> union <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Food.Item) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cantidad =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(cantidad)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>cliente_mas_gastador <span class="ot">&lt;-</span> union <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Customer.ID, First.Name, Last.Name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gasto =</span> <span class="fu">sum</span>(Price)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gasto)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>gasto_por_sexo <span class="ot">&lt;-</span> union <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender) <span class="sc">%&gt;%</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gasto_promedio =</span> <span class="fu">mean</span>(Price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="manejo-de-nas" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="manejo-de-nas"><span class="header-section-number">5.2</span> Manejo de NAs</h2>
<section id="identificación-de-datos-faltantes" class="level3">
<h3 class="anchored" data-anchor-id="identificación-de-datos-faltantes">Identificación de datos faltantes</h3>
<p>Los datos faltantes son una realidad cotidiana dentro del análisis de datos. Toda estructura de información está sujeta a fallas y esto es complementado por la posible carencia de datos provenientes del provedor.</p>
<p>Estos <em>missing</em>&nbsp;pueden aparecer de varias formas: celdas vacías, textos vacíos, o elementos que identifiquen que un dato es faltante, por ejemplo, un texto que diga “sin dato”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/extras.csv"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      date                      product revenue         city product_type
1  1 26/3/2020     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 27/5/2020     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  3 24/6/2020                   Pur Source    3117      Cabuyao             
4  4 10/7/2020 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
5  5 22/7/2020               Steamers White    3136       Timrat         gold
6  6 11/3/2020       Wine - Delicato Merlot    1939    Glinojeck         gold</code></pre>
</div>
</div>
<p>Al abrir este dataset, puede observarse con claridad que hay algunos campos que tienen valores faltantes, sin embargo, R no los identifica. Para R hay un valor faltante cuando aparece el elemento <em>NA.</em> Si éste no aparece, el contenido del dato tiene un valor. El problema en este caso es que los campos vacíos R no logra identificarlos como NA, hay que indicárselo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"../data/extras.csv"</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">encoding =</span> <span class="st">"UTF-8"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      date                      product revenue         city product_type
1  1 26/3/2020     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 27/5/2020     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  3 24/6/2020                   Pur Source    3117      Cabuyao         &lt;NA&gt;
4  4 10/7/2020 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
5  5 22/7/2020               Steamers White    3136       Timrat         gold
6  6 11/3/2020       Wine - Delicato Merlot    1939    Glinojeck         gold</code></pre>
</div>
</div>
<p>Como puede apreciarse, se agrega un parámetro denominado <em>na.strings</em> como forma de indicarle a R cuando un valor de caracter debe tomarse como NA. Además, se ha agregado un parámetro que le pide a R que los valores de texto los almacene como factores. Esto lo hacemos especialmente en este caso, para realizar un conteo de NAs mediante la función <em>summary.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id                date                          product   
 Min.   :   1.0   4/11/2020:  9   Danishes - Mini Raspberry:  5  
 1st Qu.: 250.8   13/1/2021:  8   Cake - Bande Of Fruit    :  4  
 Median : 500.5   15/2/2020:  8   Beef - Tongue, Cooked    :  3  
 Mean   : 500.5   19/7/2020:  7   Beer - Upper Canada Lager:  3  
 3rd Qu.: 750.2   29/5/2020:  7   Bouillion - Fish         :  3  
 Max.   :1000.0   (Other)  :942   (Other)                  :933  
                  NA's     : 19   NA's                     : 49  
    revenue             city      product_type
 Min.   :1001   Guadalupe :  3   gold   :302  
 1st Qu.:2049   København :  3   premiun:325  
 Median :3073   Buenavista:  2   regular:321  
 Mean   :3058   Cabrobó   :  2   NA's   : 52  
 3rd Qu.:4108   Córdoba   :  2                
 Max.   :4999   (Other)   :965                
 NA's   :23     NA's      : 23                </code></pre>
</div>
</div>
<p>De esta forma, el summary toma los NA como otro valor dentro de las variables, y realiza un conteo. Otra forma de obtener esta información es mediante la función <em>skim.</em> Esta función está pensada para realizar una serie de averiguaciones en una tabla y devolver un diagnóstico de los datos muy completo. Para usarla hay que llamar al paquete skimr</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">datos</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">date</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">341</td>
<td style="text-align: left;">4/1: 9, 13/: 8, 15/: 8, 19/: 7</td>
</tr>
<tr class="even">
<td style="text-align: left;">product</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">786</td>
<td style="text-align: left;">Dan: 5, Cak: 4, Bee: 3, Bee: 3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">city</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">954</td>
<td style="text-align: left;">Gua: 3, Køb: 3, Bue: 2, Cab: 2</td>
</tr>
<tr class="even">
<td style="text-align: left;">product_type</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">pre: 325, reg: 321, gol: 302</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">500.50</td>
<td style="text-align: right;">288.82</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">250.75</td>
<td style="text-align: right;">500.5</td>
<td style="text-align: right;">750.25</td>
<td style="text-align: right;">1000</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">revenue</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">3058.06</td>
<td style="text-align: right;">1185.29</td>
<td style="text-align: right;">1001</td>
<td style="text-align: right;">2049.00</td>
<td style="text-align: right;">3073.0</td>
<td style="text-align: right;">4108.00</td>
<td style="text-align: right;">4999</td>
<td style="text-align: left;">▇▆▆▇▇</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="manejo-de-datos-daltantes" class="level3">
<h3 class="anchored" data-anchor-id="manejo-de-datos-daltantes">Manejo de datos daltantes</h3>
<p>Luego de identificar los valores faltantes de nuestro dataframe, la decisión siguiente a tomar es qué hacer con ellos. Hay varias posibilidades</p>
<ol type="1">
<li>Eliminar los valores faltantes</li>
<li>Reemplazar las variables numéricas con:
<ol type="1">
<li><p>La media, mediana, o algún valor estadístico</p></li>
<li><p>Por ceros</p></li>
</ol></li>
<li>Reemplazar las variables categóricas con:
<ol type="1">
<li><p>El valor más frecuente</p></li>
<li><p>Otro valor (por ejemplo: “Otro”)</p></li>
</ol></li>
</ol>
<section id="eliminar-valores-faltantes" class="level4">
<h4 class="anchored" data-anchor-id="eliminar-valores-faltantes">Eliminar valores faltantes</h4>
<p>Si decidimos eliminar los valores faltantes, podemos usar la función <em>drop_na,</em> del paquete <em>tidyverse,</em> que elimina la fila entera en donde encuentra un NA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      date                      product revenue         city product_type
1  1 26/3/2020     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 27/5/2020     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  4 10/7/2020 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
4  5 22/7/2020               Steamers White    3136       Timrat         gold
5  6 11/3/2020       Wine - Delicato Merlot    1939    Glinojeck         gold
6  7  1/6/2020  Island Oasis - Magarita Mix    2283  Châteauroux         gold</code></pre>
</div>
</div>
<p>Esta función resulta bastante flexible y permite varios tratamientos de NA. Por ejemplo, si quisiéramos eliminar NA de alguinas columnas en particular, podemos aclarárselo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"product"</span>))) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      date                      product revenue         city product_type
1  1 26/3/2020     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 27/5/2020     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  3 24/6/2020                   Pur Source    3117      Cabuyao         &lt;NA&gt;
4  4 10/7/2020 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
5  5 22/7/2020               Steamers White    3136       Timrat         gold
6  6 11/3/2020       Wine - Delicato Merlot    1939    Glinojeck         gold</code></pre>
</div>
</div>
</section>
<section id="reemplazar-variables-numéricas-y-categóricas" class="level4">
<h4 class="anchored" data-anchor-id="reemplazar-variables-numéricas-y-categóricas">Reemplazar variables numéricas y categóricas</h4>
<p>Otras veces necesitamos no eliminar, sino reemplazar los valores faltantes por un valor que resulte conveniente.</p>
<blockquote class="blockquote">
<p>La decisión sobre este procedimiento debe ser acorde al contenido conceptual del dataset y no hay una solución única para todas las ocasiones.</p>
</blockquote>
<p>Si queremos generar un reemplazo de NAs por un valor calculado, digamos, la media de esa variable, podemos guardar dicho valor en un objeto y luego imputarlo con la función <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/replace_na"><em>replace_na</em>.</a> Dicha función debe recibir una lista que indique qué imputar a cada variable. Si queremos hacerlo con una sola, se especifica la variable, sino, se van agregando con comas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mean_revenue <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">mean</span>(datos<span class="sc">$</span>revenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),<span class="dv">0</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">revenue =</span> mean_revenue)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      date                      product revenue         city product_type
1  1 26/3/2020     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 27/5/2020     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  3 24/6/2020                   Pur Source    3117      Cabuyao         &lt;NA&gt;
4  4 10/7/2020 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
5  5 22/7/2020               Steamers White    3136       Timrat         gold
6  6 11/3/2020       Wine - Delicato Merlot    1939    Glinojeck         gold</code></pre>
</div>
</div>
<p>Si quisiéramos reemplazar todos los NAs de los datos numéricos por un 0, realmente específicar este valor para cada variable puede resultar tedioso. Por tanto, podemos usar un método para modificar todas las columnas numéricas de una vez, tal como se explica en los comentarios del siguiente código.</p>
<p>Pasos:</p>
<ol type="1">
<li>Selecciono la tabla con que voy a trabajar</li>
<li>Esta función es como “select” pero con condiciones. En este caso le pido que se quede con las columnas solo si son numéricas.</li>
<li>Uso la función replace y no replace_na, ya que la segunda siempre recibe una lista, y ésta es más directa. Tengo que indicarle una condición y luego el valor con qué reemplazar.</li>
<li>Finalmente, vuelvo a pegarle las variables que le quité. Puedo usar select_if nuevamente pero esta vez con la condición negativa.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="co"># Paso 1</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric) <span class="sc">%&gt;%</span> <span class="co"># Paso 2</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.),<span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># Paso 3</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">select_if</span>(datos, <span class="fu">negate</span>(is.numeric))) <span class="sc">%&gt;%</span> <span class="co"># Paso 4</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">==</span> <span class="dv">31</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id revenue      date               product city product_type
1 31       0 18/8/2020 Cheese - Gouda Smoked &lt;NA&gt;         gold</code></pre>
</div>
</div>
<p>Esto podemos aplicarlo con las variables categóricas también, por ejemplo, si queremos que los NAs sean “sin dato” o de algún valor que nos interese. Para esto vamos a necesitar un paquete para el tratamiento de valores de factores, llamada <a href="https://www.rdocumentation.org/packages/forcats/versions/0.4.0"><em>forcats</em></a>. Este paquete tiene una función dedicada expresamente para sustituir los NAs por otro valor, el truco es reemplazar las variable existente con la nueva generada a través de <em>mutate.</em> Si en vez de factores, trabajáramos con caracteres, la función <em>replace</em>&nbsp;debería ser suficiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">fct_explicit_na</span>(date, <span class="st">"1/1/1900"</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">product =</span> <span class="fu">fct_explicit_na</span>(product, <span class="st">"sinDato"</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">fct_explicit_na</span>(city, <span class="st">"Otro"</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">product_type =</span> <span class="fu">fct_explicit_na</span>(product_type, <span class="st">"Otro"</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      date                      product revenue         city product_type
1  1 26/3/2020     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 27/5/2020     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  3 24/6/2020                   Pur Source    3117      Cabuyao         Otro
4  4 10/7/2020 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
5  5 22/7/2020               Steamers White    3136       Timrat         gold
6  6 11/3/2020       Wine - Delicato Merlot    1939    Glinojeck         gold</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="manejo-de-duplicados" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="manejo-de-duplicados"><span class="header-section-number">5.3</span> Manejo de duplicados</h2>
<p>Los duplicados también suelen ser vistos como errores en los datos, pero tal como se aclara en la cita de más arriba, debe tenerse en cuenta el contenido conceptual de cada dataset para dirimir qué hacer con estos casos.</p>
<p>Los duplicados pueden no serlo de forma absoluta, puede ocurrir que haya duplicados parciales, es decir que se encuentren una serie de variables con el mismo elemento pero en otras no. Dependerá de cada caso si se eliminan, agrupan, o dejan tal cual están.</p>
<p>Para quedarnos con los valores únicos de un dataset, debemos usar la función <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/distinct"><em>distinct</em></a><em>.</em> A esta función se le indica a partir de cuáles variables debe buscar que haya combinaciones únicas. Si no se le presentan argumentos, considera a todas las variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
</div>
<p>Ambos resultados dan mil casos, por tanto, se puede concluir que el dataset no tiene duplicados si tomamos en cuenta todas sus variables. Pero si se toman algunas esto empieza a ocurrir.</p>
<p>Como puede apreciarse en los cuadros inferiores, si nos quedamos con menos variables, el distinct nos devuelve la cantidad de combinaciones únicas de éstas. También vemos que el uso del distinct indicándole cuáles variable son de interés, nos hace llegar al mismo objetivo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(city, product_type) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(city, product_type) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 969</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(city, product_type) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 969</code></pre>
</div>
</div>
<p>Por defecto al indicarle cuáles variables nos interesa obtener los valores únicos, el <em>distinct</em> elimina el resto, pero podemos evitar esto si le agregamos el parámetro <em>keep_all.</em> Debe tenerse presente que <em>distinct</em> solo se quedará con el primer registro. Si nuestra intención es que esto sea diferente, debemos ordenar el dataframe de la forma en que elimine los registros que nosotros querramos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(city, product_type) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          city product_type
1        Laxey      premiun
2 Svyetlahorsk      regular
3      Cabuyao         &lt;NA&gt;
4   Nouakchott      regular
5       Timrat         gold
6    Glinojeck         gold</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(city, product_type, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      date                      product revenue         city product_type
1  1 26/3/2020     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 27/5/2020     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  3 24/6/2020                   Pur Source    3117      Cabuyao         &lt;NA&gt;
4  4 10/7/2020 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
5  5 22/7/2020               Steamers White    3136       Timrat         gold
6  6 11/3/2020       Wine - Delicato Merlot    1939    Glinojeck         gold</code></pre>
</div>
</div>
</section>
<section id="manejo-de-fechas" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="manejo-de-fechas"><span class="header-section-number">5.4</span> Manejo de fechas</h2>
<section id="tipo-de-dato-fecha" class="level3">
<h3 class="anchored" data-anchor-id="tipo-de-dato-fecha">Tipo de dato fecha</h3>
<p>Así como los factores y los caracteres tienen sus particularidades, suelen dar menos problemas que las fechas, las cuales están condicionadas por formatos. Para manejar este tipo de dato, el paquete más usado se llama <a href="https://www.rdocumentation.org/packages/lubridate/versions/1.8.0"><em>lubridate</em></a><em>.</em></p>
<p>Muchas veces R interpreta las fechas como textos en la medida que el formato no es el mismo que el estandarizado (AAAA-MM-DD). Cuando esto ocurre, debemos transformar la variable con, por ejemplo, una función de lubridate que transforma una variable en fecha, asignándole a cada valor de la fecha el del orden de la función.</p>
<p>En este caso usaremos <em>dmy</em> ya que en nuestra variable el formato es DD/MM/YYYY. Si fuera, por ejemplo, MM-DD-AAAA, podríamos usar <em>mdy</em> (no es relevante el simbolo que separe a los elementos de la fecha). Hay también funciones que contienen horas, minutos y segundos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="fu">str</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1000 obs. of  6 variables:
 $ id          : int  1 2 3 4 5 6 7 8 9 10 ...
 $ date        : Factor w/ 341 levels "1/1/2021","1/10/2020",..: 210 223 190 21 169 29 9 79 279 142 ...
 $ product     : Factor w/ 786 levels "Alize Red Passion",..: 360 654 526 648 631 733 328 369 420 358 ...
 $ revenue     : int  3139 4726 3117 2575 3136 1939 2283 1444 2158 3853 ...
 $ city        : Factor w/ 954 levels "‘Uzeir","Agbani",..: 445 769 107 554 800 258 141 453 327 525 ...
 $ product_type: Factor w/ 3 levels "gold","premiun",..: 2 3 NA 3 1 1 1 2 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1000 obs. of  6 variables:
 $ id          : int  1 2 3 4 5 6 7 8 9 10 ...
 $ date        : Date, format: "2020-03-26" "2020-05-27" ...
 $ product     : Factor w/ 786 levels "Alize Red Passion",..: 360 654 526 648 631 733 328 369 420 358 ...
 $ revenue     : int  3139 4726 3117 2575 3136 1939 2283 1444 2158 3853 ...
 $ city        : Factor w/ 954 levels "‘Uzeir","Agbani",..: 445 769 107 554 800 258 141 453 327 525 ...
 $ product_type: Factor w/ 3 levels "gold","premiun",..: 2 3 NA 3 1 1 1 2 1 1 ...</code></pre>
</div>
</div>
</section>
<section id="generación-de-variables-de-fechas" class="level3">
<h3 class="anchored" data-anchor-id="generación-de-variables-de-fechas">Generación de variables de fechas</h3>
<p>También podemos generar variables a partir de fechas, por ejemplo podemos obtener el año, mes y día de la semana a partir de una fecha dada. También, podemos imputar una fecha en específico, por ejemplo, la de hoy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">anio =</span> <span class="fu">year</span>(date),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mes =</span> <span class="fu">month</span>(date),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dia_semana =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hoy =</span> <span class="fu">today</span>()</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id       date                      product revenue         city product_type
1  1 2020-03-26     Lettuce - Belgian Endive    3139        Laxey      premiun
2  2 2020-05-27     Table Cloth 91x91 Colour    4726 Svyetlahorsk      regular
3  3 2020-06-24                   Pur Source    3117      Cabuyao         &lt;NA&gt;
4  4 2020-07-10 Syrup - Monin - Blue Curacao    2575   Nouakchott      regular
5  5 2020-07-22               Steamers White    3136       Timrat         gold
6  6 2020-03-11       Wine - Delicato Merlot    1939    Glinojeck         gold
  anio mes dia_semana        hoy
1 2020   3        jue 2022-10-31
2 2020   5        mié 2022-10-31
3 2020   6        mié 2022-10-31
4 2020   7        vie 2022-10-31
5 2020   7        mié 2022-10-31
6 2020   3        mié 2022-10-31</code></pre>
</div>
</div>
<p>Otro valor que traen las fechas es la generación de variables calculadas a partir de fechas. Es muy común querer obtener el tiempo transcurrido entre una fecha y otra. En el siguiente ejemplo se presenta cómo encontrar la diferencia en días, meses y años. Es básicamente la división entre la cantidad de días (unidad de medida de lubridate) por el segmentador que nos interesa. El uso de los % es para que redondee.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, date) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date), <span class="at">hoy =</span> <span class="fu">today</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">anios_dif =</span> <span class="fu">interval</span>(date, hoy) <span class="sc">%/%</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">meses_dif =</span> <span class="fu">interval</span>(date, hoy) <span class="sc">%/%</span> <span class="fu">months</span>(<span class="dv">1</span>),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dias_dif =</span> <span class="fu">interval</span>(date, hoy) <span class="sc">%/%</span> <span class="fu">days</span>(<span class="dv">1</span>),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">un_anio_mas =</span> date <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">un_mes_mas =</span> date <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">1</span>),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">un_dia_mas =</span> date <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id       date        hoy anios_dif meses_dif dias_dif un_anio_mas un_mes_mas
1  1 2020-03-26 2022-10-31         2        31      949  2021-03-26 2020-04-26
2  2 2020-05-27 2022-10-31         2        29      887  2021-05-27 2020-06-27
3  3 2020-06-24 2022-10-31         2        28      859  2021-06-24 2020-07-24
4  4 2020-07-10 2022-10-31         2        27      843  2021-07-10 2020-08-10
5  5 2020-07-22 2022-10-31         2        27      831  2021-07-22 2020-08-22
6  6 2020-03-11 2022-10-31         2        31      964  2021-03-11 2020-04-11
  un_dia_mas
1 2020-03-27
2 2020-05-28
3 2020-06-25
4 2020-07-11
5 2020-07-23
6 2020-03-12</code></pre>
</div>
</div>
</section>
</section>
<section id="desafío-1" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="desafío-1"><span class="header-section-number">5.5</span> Desafío</h2>
<ol type="1">
<li><p>Genere una tabla que muestre el total de productos vendidos, y el total revenue por año y mes. Elimine los casos en donde haya valores faltantes.</p></li>
<li><p>¿Cuáles han sido, para cada año, los cinco productos menos vendidos? ¿Y los menos rentables?</p>
<ol type="1">
<li>¿Cuántos días han pasado desde que se vendieron estos productos con respecto a la última fecha registrada?</li>
</ol></li>
<li><p>Investigue si se vende más caro en la primera mitad del año o en la segunda, averiguando el promedio de venta por unidad. Convierta los valores faltantes del mes en enero.</p></li>
</ol>
<div class="cell">
<details>
<summary>Posible solución</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejercicio 1</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">anio =</span> <span class="fu">year</span>(date), <span class="at">mes =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"anio"</span>, <span class="st">"mes"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anio, mes) <span class="sc">%&gt;%</span> </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cantidad =</span> <span class="fu">n</span>(), <span class="at">total_ingreso =</span> <span class="fu">sum</span>(revenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejercico 2</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">anio =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"anio"</span>, <span class="st">"product"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anio, product) <span class="sc">%&gt;%</span> </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cantidad =</span> <span class="fu">n</span>(), <span class="at">total_ingreso =</span> <span class="fu">sum</span>(revenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>   <span class="fu">arrange</span>(cantidad) <span class="sc">%&gt;%</span> </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">anio =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"anio"</span>, <span class="st">"product"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anio, product) <span class="sc">%&gt;%</span> </span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cantidad =</span> <span class="fu">n</span>(), <span class="at">total_ingreso =</span> <span class="fu">sum</span>(revenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>   <span class="fu">arrange</span>(total_ingreso) <span class="sc">%&gt;%</span> </span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejercicio 2 parte b</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">anio =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"anio"</span>, <span class="st">"product"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anio, product) <span class="sc">%&gt;%</span> </span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cantidad =</span> <span class="fu">n</span>(), <span class="at">total_ingreso =</span> <span class="fu">sum</span>(revenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(total_ingreso) <span class="sc">%&gt;%</span> </span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(product) <span class="sc">%&gt;%</span> </span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(datos, <span class="at">by =</span> <span class="st">'product'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date), <span class="at">hoy =</span> <span class="fu">today</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dias_desde_que_se_vendio =</span> <span class="fu">interval</span>(date, hoy) <span class="sc">%/%</span> <span class="fu">days</span>(<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(product, dias_desde_que_se_vendio) <span class="sc">%&gt;%</span> </span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejercicio 3</span></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> </span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mes =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">mes =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">parte_del_anio =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>      mes <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Primera parte"</span>,</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>      mes <span class="sc">&gt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Segunda parte"</span></span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parte_del_anio) <span class="sc">%&gt;%</span> </span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cantidad =</span> <span class="fu">n</span>(), <span class="at">total_ingreso =</span> <span class="fu">sum</span>(revenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">promedio_venta =</span> total_ingreso<span class="sc">/</span>cantidad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/data_analisis.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Análisis de datos con R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/visualization.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Visualización de datos</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>